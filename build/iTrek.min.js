!function(t){"use strict";function e(){}function s(t,e){return e.indexOf(t)>-1}function r(t){return Array.prototype.slice.apply(t,Array.prototype.slice.call(arguments,1))}function n(t,e){return(e||document).querySelector(t)}function i(t,e){t.classList?t.classList.add(e):t.className+=" "+e}function o(t,e){t.classList?t.classList.remove(e):t.className=t.className.replace(new RegExp("\\s*\\b"+e+"\\b","g"),"")}var a=function(){var t=r(arguments,0,3);if(!t.length)throw new Error("参数错误!");var e=t.slice(-1)[0];if(e.dom=t[0],!e.dom)throw new Error("容器不能为空!");this._opts={wrap:".wrap",item:".item",playClass:"play",index:0,noslide:[],noslideBack:!1,speed:400,triggerDist:30,isVertical:!0,useACC:!0,fullScr:!0,preventMove:!1,lastLocate:!0,onslide:function(t){}};for(var s in e)this._opts[s]=e[s];e=null,t=null,this._setting(),this.fire("initialize"),this._renderWrapper(),this._bindEvent(),this.fire("initialized")};a.EVENTS=["initialize","initialized","renderComplete","slide","slideStart","slideEnd","slideChange","slideChanged","slideRestore","reset","destroy"],a.prototype._bindEvent=function(){var t=this,e=t._opts,s=e.fullScr?n("body"):t.wrap;s.addEventListener("touchstart",function(e){t._touchstart(e)},!1),s.addEventListener("touchmove",function(s){t._touchmove(s),e.fullScr||(s.stopPropagation(),s.preventDefault())},!1),s.addEventListener("touchend",function(e){t._touchend(e)},!1),s.addEventListener("touchcancel",function(e){t._touchend(e)},!1)},a.prototype._touchstart=function(t){var e=this,s=e._opts;if(1===t.touches.length){e.lockSlide=!1,e._touchStartX=t.touches[0].pageX,e._touchStartY=t.touches[0].pageY,e.touchInitPos=s.isVertical?t.touches[0].pageY:t.touches[0].pageX,e.trek1=e.touchInitPos,e.startPos=0,e.startPosPrev=-e.scrollDist,e.startPosNext=e.scrollDist;var r="-webkit-transition-duration:0;-moz-transition-duration:0;-ms-transition-duration:0;-o-transition-duration:0;transition-duration:0;";e._next&&(e._next.style.cssText+=r),e._current.style.cssText+=r,e._prev&&(e._prev.style.cssText+=r)}},a.prototype._touchmove=function(t){var e=t.target;do e=e.parentNode;while(e!=this.wrap);if(e||t.target==this.wrap){var s=this,r=s._opts;if(1===t.touches.length&&!s.lockSlide){var n=Math.abs(t.touches[0].pageX-s._touchStartX),i=Math.abs(t.touches[0].pageY-s._touchStartY);if(n>i&&r.isVertical)return void(s.lockSlide=!0);if(i>n&&!r.isVertical)return void(s.lockSlide=!0);var o=r.isVertical?t.touches[0].pageY:t.touches[0].pageX;s.trek2=o-s.trek1,s.totalDist=s.startPos+o-s.touchInitPos,s._current.style.cssText+=s._getTransform(s.totalDist+"px"),s.startPos=s.totalDist,s.totalDist<0?s._next&&(s.totalDist2=s.startPosNext+o-s.touchInitPos,s._next.style.cssText+=s._getTransform(s.totalDist2+"px"),s.startPosNext=s.totalDist2):s._prev&&(s.totalDist2=s.startPosPrev+o-s.touchInitPos,s._prev.style.cssText+=s._getTransform(s.totalDist2+"px"),s.startPosPrev=s.totalDist2),s.touchInitPos=o}}},a.prototype._touchend=function(t){var e=this,s=e._opts;e.trek2<-s.triggerDist?e.next():e.trek2>s.triggerDist?e.prev():e._itemReset(),e.trek2=0},a.prototype._itemReset=function(){var t=this;t._opts;t._current.style.cssText+=t.getDurationCss(0),t._prev&&(t._prev.style.cssText+=t.getDurationCss("-"+t.scrollDist+"px")),t._next&&(t._next.style.cssText+=t.getDurationCss(+t.scrollDist+"px")),t.trek2=0},a.prototype._renderWrapper=function(){var t=this,e=t._opts;if(t.wrap="string"==typeof e.dom?n(e.dom):e.dom,!t.wrap)throw new Error("容器空!");t.index=e.index,t._tpl=t.wrap.cloneNode(!0),t._tpl=e.item?t._tpl.querySelectorAll(e.item):t._tpl.children;for(var s=0;s<t._tpl.length;s++)t._tpl[s].style.cssText+="display:block;position:absolute;left:0;top:0;width:100%;height:100%";if(t.length=t._tpl.length,t.touchInitPos=0,t.startPos=0,t.totalDist=0,t.trek1=0,t.trek2=0,e.fullScr){var r=document.createElement("style");r.innerHTML="html,body{width:100%; height:100%; overflow:hidden}",document.head.appendChild(r),r=null}t.wrap.style.cssText+="display:block; position:relative;"+(e.fullScr?"width:100%; height:100%":""),t.displayWidth=t.wrap.clientWidth,t.displayHeight=t.wrap.clientHeight,t.scrollDist=e.isVertical?t.displayHeight:t.displayWidth,t._setHTML(),/iPhone|iPod|iPad/.test(navigator.userAgent)&&(t._delayTime=50)},a.prototype._setHTML=function(t){var e=this;t&&t>0&&(e.index=+t),e.wrap.innerHTML="";var s=document.createDocumentFragment();e.index>0?(e._prev=e._tpl[e.index-1].cloneNode(!0),e._prev.style.cssText+=e._getTransform("-"+e.scrollDist+"px"),s.appendChild(e._prev)):e._prev=null,e._current=e._tpl[e.index].cloneNode(!0),e._current.style.cssText+=e._getTransform(0),s.appendChild(e._current),e.index<e.length-1?(e._next=e._tpl[e.index+1].cloneNode(!0),e._next.style.cssText+=e._getTransform("+"+e.scrollDist+"px"),s.appendChild(e._next)):e._next=null,e.wrap.appendChild(s)},a.prototype.getDurationCss=function(t,e){return"-webkit-transition-duration:"+(e||this._opts.speed)+"ms;"+this._getTransform(t)+"transition-duration:"+(e||this._opts.speed)+"ms;"+this._getTransform(t)},a.prototype._getTransform=function(t){var e=this._opts.useACC,s=this._opts.isVertical?"0, "+t:t+", 0";return"-webkit-transform:"+(e?"translate3d("+s+", 0);":"translate("+s+");")+"-moz-transform:"+(e?"translate3d("+s+", 0);":"translate("+s+");")+"-ms-transform:"+(e?"translate3d("+s+", 0);":"translate("+s+");")+"-o-transform:"+(e?"translate3d("+s+", 0);":"translate("+s+");")+"transform:"+(e?"translate3d("+s+", 0);":"translate("+s+");")},a.prototype._setting=function(){var s=this,r=this._opts;s.events={},a.EVENTS.forEach(function(t){var e=r["on"+t.toLowerCase()];"function"==typeof e&&s.on(t,e,1)}),s.log=r.isDebug?function(){t.console.log.apply(t.console,arguments)}:e},a.prototype.prev=function(){var t=this,e=t._opts;return t._current&&t._prev?t.index>0?(t.index--,t._next&&t.wrap.removeChild(t._next),t._next=t._current,t._current=t._prev,t._prev=null,t._next.style.cssText+=t.getDurationCss(+t.scrollDist+"px"),t._current.style.cssText+=t.getDurationCss(0),void setTimeout(function(){n("."+e.playClass,t.wrap)&&o(n("."+e.playClass,t.wrap),e.playClass),i(t._current,e.playClass);try{e.onslide.call(t,t.index)}catch(s){console.info(s)}var r=t.index-1;return 0>r?(r=t.length-1,!1):(t._prev=t._tpl[r].cloneNode(!0),t._prev.style.cssText+=t.getDurationCss(+t.scrollDist+"px",0),void t.wrap.insertBefore(t._prev,t._current))},t._delayTime)):(t._itemReset(),!1):void t._itemReset()},a.prototype.next=function(){var t=this,e=t._opts;return t._current&&t._next?t.index<t.length-1?(t.index++,t._prev&&t.wrap.removeChild(t._prev),t._prev=t._current,t._current=t._next,t._next=null,t._prev.style.cssText+=t.getDurationCss("-"+t.scrollDist+"px"),t._current.style.cssText+=t.getDurationCss(0),void setTimeout(function(){n("."+e.playClass,t.wrap)&&o(n("."+e.playClass,t.wrap),e.playClass),i(t._current,e.playClass);try{e.onslide.call(t,t.index)}catch(s){console.info(s)}var r=t.index+1;return r>=t.length?!1:(t._next=t._tpl[r].cloneNode(!0),t._next.style.cssText+=t.getDurationCss(+t.scrollDist+"px",0),void t.wrap.appendChild(t._next))},t._delayTime)):(t._itemReset(),!1):void t._itemReset()},a.prototype.on=function(t,e,r){return s(t,a.EVENTS)&&"function"==typeof e&&(!(t in this.events)&&(this.events[t]=[]),r?this.events[t].unshift(e):this.events[t].push(e)),this},a.prototype.fire=function(t){var e=r(arguments,1);t.split(/\x20+/).forEach(function(t){if(this.log("[EVENT FIRE]:",t,e),t in this.events)for(var s=this.events[t],r=0;r<s.length;r++)"function"==typeof s[r]&&s[r].apply&&s[r].apply(this,e)}.bind(this))},"function"==typeof require&&module&&"object"==typeof module&&exports&&"object"==typeof exports?module.exports=a:"function"==typeof define&&define.amd?define(function(){return a}):t.iTrek=t.iTrek||a}(window||this);